<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head(title='Keranjang Belanja')}">
    <title>Keranjang Belanja - Dikoding Muda Nusantara</title>
</head>
<!-- Page Specific Styles -->
<style>
    body {
        background: var(--color-bg-subtle);
    }

    /* Main Container */
    .main-container {
        padding: 2rem 0 4rem;
        min-height: calc(100vh - 200px);
    }

    /* Page Header */
    .page-header {
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--color-text);
        margin-bottom: .5rem;
    }

    .page-subtitle {
        font-size: .9375rem;
        color: var(--color-text-secondary);
        margin-bottom: 0;
    }

    /* Cart Items */
    .cart-items {
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-border);
        overflow: hidden;
    }

    .cart-item {
        display: flex;
        gap: 1.25rem;
        padding: 1.5rem;
        border-bottom: 1px solid var(--color-border);
        transition: var(--transition);
    }

    .cart-item:last-child {
        border-bottom: none;
    }

    .cart-item:hover {
        background: var(--color-bg-subtle);
    }

    .item-thumbnail {
        width: 160px;
        height: 90px;
        border-radius: var(--radius-md);
        overflow: hidden;
        flex-shrink: 0;
        background: var(--color-bg-muted);
    }

    .item-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .item-details {
        flex: 1;
        min-width: 0;
    }

    .item-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: .375rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .item-title a {
        color: inherit;
        text-decoration: none;
    }

    .item-title a:hover {
        color: var(--color-primary);
    }

    .item-lecturer {
        font-size: .8125rem;
        color: var(--color-text-muted);
        margin-bottom: .5rem;
    }

    .item-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: .8125rem;
        color: var(--color-text-secondary);
    }

    .item-meta-item {
        display: flex;
        align-items: center;
        gap: .375rem;
    }

    .item-meta-item svg {
        color: var(--color-text-muted);
    }

    .item-actions {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: .75rem;
    }

    .item-price {
        text-align: right;
    }

    .price-current {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--color-text);
    }

    .price-original {
        font-size: .8125rem;
        color: var(--color-text-muted);
        text-decoration: line-through;
    }

    .btn-remove {
        display: flex;
        align-items: center;
        gap: .375rem;
        padding: .5rem .75rem;
        background: none;
        border: none;
        font-size: .8125rem;
        color: var(--color-error);
        cursor: pointer;
        transition: var(--transition);
        border-radius: var(--radius-sm);
    }

    .btn-remove:hover {
        background: #fef2f2;
    }

    /* Cart Summary */
    .cart-summary {
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-border);
        padding: 1.5rem;
        position: sticky;
        top: 90px;
    }

    .summary-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1.25rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--color-border);
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: .625rem 0;
        font-size: .9375rem;
    }

    .summary-label {
        color: var(--color-text-secondary);
    }

    .summary-value {
        font-weight: 500;
    }

    .summary-discount {
        color: var(--color-success);
    }

    .summary-divider {
        height: 1px;
        background: var(--color-border);
        margin: 1rem 0;
    }

    .summary-total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: .5rem 0;
    }

    .summary-total-label {
        font-size: 1rem;
        font-weight: 600;
    }

    .summary-total-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--color-text);
    }

    .summary-actions {
        margin-top: 1.5rem;
    }

    .summary-actions .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: .5rem;
        padding: 1rem;
        font-size: 1rem;
    }

    /* Coupon Section */
    .coupon-section {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--color-border);
    }

    .coupon-label {
        font-size: .875rem;
        font-weight: 500;
        margin-bottom: .75rem;
        display: block;
        color: var(--color-text);
    }

    .coupon-input-group {
        display: flex;
        gap: .5rem;
    }

    .coupon-input {
        flex: 1;
        padding: .75rem 1rem;
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        font-size: .9375rem;
        transition: var(--transition);
    }

    .coupon-input:focus {
        outline: none;
        border-color: var(--color-primary);
    }

    .coupon-input::placeholder {
        color: var(--color-text-muted);
    }

    .btn-apply {
        padding: .75rem 1.25rem;
        background: var(--color-bg-muted);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        font-size: .875rem;
        font-weight: 600;
        color: var(--color-text);
        cursor: pointer;
        transition: var(--transition);
    }

    .btn-apply:hover {
        background: var(--color-bg-subtle);
        border-color: var(--color-primary);
    }

    /* Security Badge */
    .security-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: .5rem;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--color-border);
        font-size: .8125rem;
        color: var(--color-text-muted);
    }

    .security-badge svg {
        color: var(--color-success);
    }

    /* Empty Cart */
    .cart-empty {
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-border);
        padding: 4rem 2rem;
        text-align: center;
    }

    .cart-empty-icon {
        margin-bottom: 1.5rem;
    }

    .cart-empty-icon svg {
        color: var(--color-text-muted);
    }

    .cart-empty h2 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: .5rem;
        color: var(--color-text);
    }

    .cart-empty p {
        font-size: .9375rem;
        color: var(--color-text-secondary);
        margin-bottom: 1.5rem;
    }

    .cart-empty .btn {
        display: inline-flex;
        align-items: center;
        gap: .5rem;
    }

    /* Responsive */
    @media (max-width: 991px) {
        .cart-summary {
            position: static;
        }
    }

    @media (max-width: 768px) {
        .cart-item {
            flex-direction: column;
            gap: 1rem;
        }

        .item-thumbnail {
            width: 100%;
            height: auto;
            aspect-ratio: 16/9;
        }

        .item-actions {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .item-price {
            text-align: left;
        }
    }

    @media (max-width: 480px) {
        .main-container {
            padding: 1.5rem 0;
        }

        .page-title {
            font-size: 1.5rem;
        }

        .cart-item {
            padding: 1rem;
        }

        .cart-summary {
            padding: 1.25rem;
        }
    }
</style>
<body>

<!-- Navbar -->
<nav th:replace="~{fragments/layout :: navbar(activeMenu='')}"></nav>

<!-- Main Content -->
<main class="main-container">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Keranjang Belanja</h1>
            <p class="page-subtitle" th:if="${cartItems != null and !#lists.isEmpty(cartItems)}" 
               th:text="${#lists.size(cartItems)} + ' kursus di keranjang'">2 kursus di keranjang</p>
        </div>
        
        <!-- Cart Layout -->
        <div class="row" th:if="${cartItems != null and !#lists.isEmpty(cartItems)}">
            <!-- Cart Items -->
            <div class="col-lg-8 mb-4 mb-lg-0">
                <div class="cart-items">
                    <div th:each="item : ${cartItems}" class="cart-item">
                        <div class="item-thumbnail">
                            <img th:src="${item.course.thumbnailUrl != null} ? @{/files/view(path=${item.course.thumbnailUrl})} : '/images/default-course.png'" 
                                 th:alt="${item.course.title}">
                        </div>
                        
                        <div class="item-details">
                            <h3 class="item-title">
                                <a th:href="@{/courses/{slug}(slug=${item.course.slug})}" th:text="${item.course.title}">
                                    Judul Kursus
                                </a>
                            </h3>
                            <p class="item-lecturer" th:text="'Oleh ' + ${item.course.lecturer.firstName + ' ' + item.course.lecturer.lastName}">Oleh John Doe</p>
                            
                            <div class="item-meta">
                                <span class="item-meta-item">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="5 3 19 12 5 21 5 3"/>
                                    </svg>
                                    <span th:text="${item.course.totalLessons} + ' materi'">24 materi</span>
                                </span>
                                <span class="item-meta-item">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    <span th:text="${item.course.totalDuration} + ' menit'">120 menit</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="item-actions">
                            <div class="item-price">
                                <!-- Jika ada diskon -->
                                <th:block th:if="${item.course.discountPrice != null}">
                                    <div class="price-current" th:text="'Rp ' + ${#numbers.formatInteger(item.course.discountPrice, 3, 'POINT')}">Rp 199.000</div>
                                    <div class="price-original" th:text="'Rp ' + ${#numbers.formatInteger(item.course.price, 3, 'POINT')}">Rp 499.000</div>
                                </th:block>
                                <!-- Jika tidak ada diskon -->
                                <th:block th:if="${item.course.discountPrice == null}">
                                    <div class="price-current" th:text="'Rp ' + ${#numbers.formatInteger(item.course.price, 3, 'POINT')}">Rp 199.000</div>
                                </th:block>
                            </div>
                            
                            <form th:action="@{/cart/remove}" method="post">
                                <input type="hidden" name="itemId" th:value="${item.id}">
                                <button type="submit" class="btn-remove">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                    Hapus
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cart Summary -->
            <div class="col-lg-4">
                <div class="cart-summary">
                    <h2 class="summary-title">Ringkasan Pesanan</h2>
                    
                    <div class="summary-row">
                        <span class="summary-label">Subtotal</span>
                        <span class="summary-value" th:text="'Rp ' + ${#numbers.formatInteger(subtotal != null ? subtotal : total, 3, 'POINT')}">Rp 698.000</span>
                    </div>
                    
                    <div class="summary-row" th:if="${discount != null and discount > 0}">
                        <span class="summary-label">Diskon</span>
                        <span class="summary-value summary-discount" th:text="'- Rp ' + ${#numbers.formatInteger(discount, 3, 'POINT')}">- Rp 100.000</span>
                    </div>
                    
                    <div class="summary-divider"></div>
                    
                    <div class="summary-total">
                        <span class="summary-total-label">Total</span>
                        <span class="summary-total-value" th:text="'Rp ' + ${#numbers.formatInteger(total, 3, 'POINT')}">Rp 598.000</span>
                    </div>
                    
                    <div class="summary-actions">
                        <a href="/checkout" class="btn btn-primary-custom w-100">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                            Lanjut ke Pembayaran
                        </a>
                    </div>
                    
                    <!-- Coupon Section -->
                    <div class="coupon-section">
                        <label class="coupon-label">Punya kupon?</label>
                        <form th:action="@{/cart/apply-coupon}" method="post" class="coupon-input-group">
                            <input type="text" name="couponCode" class="coupon-input" placeholder="Masukkan kode kupon">
                            <button type="submit" class="btn-apply">Terapkan</button>
                        </form>
                    </div>
                    
                    <!-- Security Badge -->
                    <div class="security-badge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        <span>Pembayaran aman & terenkripsi</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Empty Cart -->
        <div class="row" th:if="${cartItems == null or #lists.isEmpty(cartItems)}">
            <div class="col-lg-8 mx-auto">
                <div class="cart-empty">
                    <div class="cart-empty-icon">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="9" cy="21" r="1"/>
                            <circle cx="20" cy="21" r="1"/>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                        </svg>
                    </div>
                    <h2>Keranjang Kosong</h2>
                    <p>Belum ada kursus di keranjang. Yuk mulai eksplorasi kursus yang menarik!</p>
                    <a href="/courses" class="btn btn-primary-custom">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        Jelajahi Kursus
                    </a>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer th:replace="~{fragments/layout :: footer}"></footer>

<!-- Scripts -->
<th:block th:replace="~{fragments/layout :: scripts}"></th:block>

</body>
</html>