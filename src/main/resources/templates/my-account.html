<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head(title='My Account')}">
    <title>My Account - Dikoding Muda Nusantara</title>
</head>
<body>

<!-- Navbar -->
<nav th:replace="~{fragments/layout :: navbar(activeMenu='')}"></nav>

<!-- Main Content -->
<main class="account-page">
    <div class="container py-5">
        <div class="row g-4">
            
            <!-- Sidebar -->
            <div class="col-lg-3">
                <div class="account-sidebar">
                    <!-- User Info Card -->
                    <div class="user-card">
                        <div class="user-card-avatar" th:text="${#strings.substring(user.firstName, 0, 1) + #strings.substring(user.lastName, 0, 1)}">UN</div>
                        <h4 class="user-card-name" th:text="${user.firstName + ' ' + user.lastName}">User Name</h4>
                        <span class="user-card-role" th:text="${role}">Student</span>
                        <div class="user-card-email" th:text="${user.email}">user@email.com</div>
                    </div>
                    
                    <!-- Sidebar Menu -->
                    <div class="sidebar-menu">
                        <a href="#profile" class="sidebar-menu-item active" data-tab="profile">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            Profil
                        </a>
                        <a href="#security" class="sidebar-menu-item" data-tab="security">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                            Keamanan
                        </a>
                        <a th:if="${role == 'Student' or role == 'Lecturer'}" href="#balance" class="sidebar-menu-item" data-tab="balance">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                            Saldo
                        </a>
                        <a href="#account-info" class="sidebar-menu-item" data-tab="account-info">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="16" x2="12" y2="12"/>
                                <line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                            Info Akun
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="col-lg-9">
                <div class="account-content">
                    
                    <!-- Alert Messages -->
                    <div th:if="${successMessage}" class="alert alert-success">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <span th:text="${successMessage}">Success message</span>
                    </div>
                    
                    <div th:if="${errorMessage}" class="alert alert-danger">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <span th:text="${errorMessage}">Error message</span>
                    </div>

                    <!-- Profile Tab -->
                    <div id="profile" class="tab-pane active">
                        <div class="content-header">
                            <h3 class="content-title">Informasi Profil</h3>
                            <p class="content-description">Perbarui informasi profil dan alamat email akunmu</p>
                        </div>
                        
                        <div class="content-card">
                            <form th:action="@{/my-account/update-profile}" method="post" th:object="${profileDTO}">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Nama Depan *</label>
                                        <input type="text" class="form-control" th:field="*{firstName}" 
                                               th:classappend="${#fields.hasErrors('firstName')} ? 'is-invalid' : ''"
                                               placeholder="Masukkan nama depan">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}">Error</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Nama Belakang</label>
                                        <input type="text" class="form-control" th:field="*{lastName}" 
                                               placeholder="Masukkan nama belakang">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Username *</label>
                                        <input type="text" class="form-control" th:field="*{username}" 
                                               th:classappend="${#fields.hasErrors('username')} ? 'is-invalid' : ''"
                                               placeholder="Masukkan username">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('username')}" th:errors="*{username}">Error</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Email *</label>
                                        <input type="email" class="form-control" th:field="*{email}" 
                                               th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"
                                               placeholder="Masukkan email">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Error</div>
                                    </div>
                                    <div class="col-12 mt-4">
                                        <button type="submit" class="btn-primary-custom">Simpan Perubahan</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Security Tab -->
                    <div id="security" class="tab-pane">
                        <div class="content-header">
                            <h3 class="content-title">Keamanan Akun</h3>
                            <p class="content-description">Perbarui password untuk menjaga keamanan akunmu</p>
                        </div>
                        
                        <div class="content-card">
                            <form th:action="@{/my-account/change-password}" method="post" th:object="${passwordDTO}">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label class="form-label">Password Saat Ini *</label>
                                        <input type="password" class="form-control" th:field="*{currentPassword}"
                                               th:classappend="${#fields.hasErrors('currentPassword')} ? 'is-invalid' : ''"
                                               placeholder="Masukkan password saat ini">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}">Error</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Password Baru *</label>
                                        <input type="password" class="form-control" th:field="*{newPassword}"
                                               th:classappend="${#fields.hasErrors('newPassword')} ? 'is-invalid' : ''"
                                               placeholder="Masukkan password baru">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}">Error</div>
                                        <small class="text-muted">Minimal 8 karakter</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Konfirmasi Password *</label>
                                        <input type="password" class="form-control" th:field="*{confirmPassword}"
                                               th:classappend="${#fields.hasErrors('confirmPassword')} ? 'is-invalid' : ''"
                                               placeholder="Konfirmasi password baru">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}">Error</div>
                                    </div>
                                    <div class="col-12 mt-4">
                                        <button type="submit" class="btn-primary-custom">Ubah Password</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Balance Tab -->
                    <div id="balance" class="tab-pane" th:if="${role == 'Student' or role == 'Lecturer'}">
                        <div class="content-header">
                            <h3 class="content-title">Saldo Akun</h3>
                            <p class="content-description">Lihat dan kelola saldo akunmu</p>
                        </div>
                        
                        <div class="content-card">
                            <div class="balance-display">
                                <span class="balance-label">Saldo Tersedia</span>
                                <span class="balance-amount" th:text="${#numbers.formatDecimal(balance != null ? balance.amount : 0, 0, 'COMMA', 0, 'POINT')}">0</span>
                                <span class="balance-currency">IDR</span>
                            </div>
                            
                            <div class="balance-info mt-4">
                                <p class="text-muted mb-0">
                                    Terakhir diperbarui: 
                                    <span th:if="${balance != null}" th:text="${#temporals.format(balance.lastUpdateDate, 'dd MMMM yyyy')}">-</span>
                                    <span th:if="${balance == null}">-</span>
                                </p>
                            </div>
                            
                            <div class="balance-actions mt-4" th:if="${role == 'Student'}">
                                <a href="/topup" class="btn-primary-custom">Top Up Saldo</a>
                                <a href="/transactions" class="btn-outline-custom ms-2">Riwayat Transaksi</a>
                            </div>
                            
                            <div class="balance-actions mt-4" th:if="${role == 'Lecturer'}">
                                <a href="/lecturer/withdraw" class="btn-primary-custom">Tarik Saldo</a>
                                <a href="/lecturer/earnings" class="btn-outline-custom ms-2">Riwayat Pendapatan</a>
                            </div>
                        </div>
                    </div>

                    <!-- Account Info Tab -->
                    <div id="account-info" class="tab-pane">
                        <div class="content-header">
                            <h3 class="content-title">Informasi Akun</h3>
                            <p class="content-description">Detail akun dan status keanggotaan</p>
                        </div>
                        
                        <div class="content-card">
                            <div class="info-list">
                                <div class="info-item">
                                    <span class="info-label">User ID</span>
                                    <span class="info-value" th:text="${user.userId}">1</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Tipe Akun</span>
                                    <span class="info-value">
                                        <span class="badge-custom badge-primary" th:text="${role}">Student</span>
                                    </span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Tanggal Bergabung</span>
                                    <span class="info-value" th:text="${#dates.format(user.joinDate, 'dd MMMM yyyy')}">01 Januari 2025</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Status Akun</span>
                                    <span class="info-value">
                                        <span class="badge-custom badge-success">Aktif</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Danger Zone -->
                        <div class="content-card danger-zone mt-4">
                            <h4 class="danger-title">Zona Berbahaya</h4>
                            <p class="danger-description">Setelah menghapus akun, semua data akan hilang secara permanen. Harap berhati-hati.</p>
                            <button type="button" class="btn-danger-custom" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                Hapus Akun
                            </button>
                        </div>
                    </div>
                    
                </div>
            </div>
            
        </div>
    </div>
</main>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">Konfirmasi Hapus Akun</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Apakah kamu yakin ingin menghapus akun? Tindakan ini tidak dapat dibatalkan.</p>
                <form th:action="@{/my-account/delete}" method="post" id="deleteAccountForm">
                    <div class="mb-3">
                        <label class="form-label">Masukkan password untuk konfirmasi:</label>
                        <input type="password" class="form-control" name="password" required placeholder="Password">
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn-outline-custom" data-bs-dismiss="modal">Batal</button>
                <button type="submit" form="deleteAccountForm" class="btn-danger-custom">Ya, Hapus Akun</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer th:replace="~{fragments/layout :: footer}"></footer>

<!-- Scripts -->
<th:block th:replace="~{fragments/layout :: scripts}"></th:block>

<!-- Page Specific Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality
        const sidebarItems = document.querySelectorAll('.sidebar-menu-item');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        sidebarItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetTab = this.getAttribute('data-tab');
                
                // Update active states
                sidebarItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                tabPanes.forEach(pane => {
                    pane.classList.remove('active');
                    if (pane.id === targetTab) {
                        pane.classList.add('active');
                    }
                });
                
                // Update URL hash
                history.pushState(null, null, '#' + targetTab);
            });
        });
        
        // Handle initial hash
        const hash = window.location.hash.substring(1);
        if (hash) {
            const targetItem = document.querySelector(`.sidebar-menu-item[data-tab="${hash}"]`);
            if (targetItem) {
                targetItem.click();
            }
        }
    });
</script>

<!-- Page Specific Styles -->
<style>
    /* Account Page Specific Styles */
    .account-page {
        background: var(--color-bg-subtle);
        min-height: calc(100vh - 200px);
    }
    
    /* Sidebar Styles */
    .account-sidebar {
        position: sticky;
        top: 100px;
    }
    
    .user-card {
        background: var(--color-bg);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        text-align: center;
        margin-bottom: 1rem;
    }
    
    .user-card-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--color-primary-light);
        color: var(--color-primary);
        font-size: 1.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
    }
    
    .user-card-name {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: 0.25rem;
    }
    
    .user-card-role {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: var(--color-primary-light);
        color: var(--color-primary);
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 100px;
        margin-bottom: 0.5rem;
    }
    
    .user-card-email {
        font-size: 0.875rem;
        color: var(--color-text-muted);
    }
    
    /* Sidebar Menu */
    .sidebar-menu {
        background: var(--color-bg);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        overflow: hidden;
    }
    
    .sidebar-menu-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 1.25rem;
        color: var(--color-text-secondary);
        font-weight: 500;
        font-size: 0.9375rem;
        border-bottom: 1px solid var(--color-border);
        transition: var(--transition);
    }
    
    .sidebar-menu-item:last-child {
        border-bottom: none;
    }
    
    .sidebar-menu-item:hover {
        background: var(--color-bg-subtle);
        color: var(--color-text);
    }
    
    .sidebar-menu-item.active {
        background: var(--color-primary-light);
        color: var(--color-primary);
    }
    
    .sidebar-menu-item svg {
        flex-shrink: 0;
    }
    
    /* Content Area */
    .content-header {
        margin-bottom: 1.5rem;
    }
    
    .content-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: 0.25rem;
    }
    
    .content-description {
        font-size: 0.9375rem;
        color: var(--color-text-secondary);
        margin-bottom: 0;
    }
    
    .content-card {
        background: var(--color-bg);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        padding: 1.5rem;
    }
    
    /* Tab Panes */
    .tab-pane {
        display: none;
    }
    
    .tab-pane.active {
        display: block;
    }
    
    /* Balance Display */
    .balance-display {
        text-align: center;
        padding: 2rem 0;
    }
    
    .balance-label {
        display: block;
        font-size: 0.875rem;
        color: var(--color-text-muted);
        margin-bottom: 0.5rem;
    }
    
    .balance-amount {
        display: block;
        font-size: 3rem;
        font-weight: 700;
        color: var(--color-text);
        line-height: 1;
    }
    
    .balance-currency {
        display: block;
        font-size: 1rem;
        color: var(--color-text-secondary);
        margin-top: 0.5rem;
    }
    
    .balance-info {
        text-align: center;
        padding-top: 1rem;
        border-top: 1px solid var(--color-border);
    }
    
    .balance-actions {
        text-align: center;
    }
    
    /* Info List */
    .info-list {
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    
    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid var(--color-border);
    }
    
    .info-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    
    .info-item:first-child {
        padding-top: 0;
    }
    
    .info-label {
        font-size: 0.9375rem;
        color: var(--color-text-secondary);
    }
    
    .info-value {
        font-size: 0.9375rem;
        font-weight: 500;
        color: var(--color-text);
    }
    
    /* Danger Zone */
    .danger-zone {
        border-color: var(--color-danger);
        background: var(--color-danger-light);
    }
    
    .danger-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--color-danger);
        margin-bottom: 0.5rem;
    }
    
    .danger-description {
        font-size: 0.875rem;
        color: var(--color-text-secondary);
        margin-bottom: 1rem;
    }
    
    /* Modal Styles */
    .modal-content {
        border: none;
        border-radius: var(--radius-md);
    }
    
    .modal-header {
        padding: 1.25rem 1.5rem;
    }
    
    .modal-title {
        font-weight: 600;
    }
    
    .modal-body {
        padding: 0 1.5rem 1rem;
    }
    
    .modal-footer {
        padding: 1rem 1.5rem 1.25rem;
    }
    
    /* Responsive */
    @media (max-width: 991px) {
        .account-sidebar {
            position: relative;
            top: 0;
        }
        
        .sidebar-menu {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        
        .sidebar-menu-item {
            flex: 1;
            min-width: 120px;
            justify-content: center;
            text-align: center;
            border-bottom: none;
            border-right: 1px solid var(--color-border);
        }
        
        .sidebar-menu-item:last-child {
            border-right: none;
        }
        
        .sidebar-menu-item svg {
            display: none;
        }
    }
    
    @media (max-width: 575px) {
        .sidebar-menu-item {
            padding: 0.75rem;
            font-size: 0.8125rem;
        }
        
        .balance-amount {
            font-size: 2.25rem;
        }
    }
</style>

</body>
</html>